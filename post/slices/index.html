<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>Small Gotcha in Go slices</title>
  <meta name="description" content="Small Gotcha in Go slices">
  <meta name="author" content="Shantanu Joshi">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="http://joshi4.github.io//css/fonts.css">
  <link rel="stylesheet" href="http://joshi4.github.io//css/normalize.css">
  <link rel="stylesheet" href="http://joshi4.github.io//css/skeleton.css">
  <link rel="stylesheet" href="http://joshi4.github.io//css/custom.css">

  
  
  <link rel="stylesheet" href="http://joshi4.github.io//highlight/styles/default.css">
  
  <script src="http://joshi4.github.io//highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

<header id="menu">
  <div class="container">
	<span class="logo">Shantanu Joshi</span>
	<a>&#9776;</a>
  </div>
</header>

<nav class="navbar">
  <div class="container">
	<div class="row">
	  <div class="eight columns offset-by-two">
		<ul class="">
		  
		  <li class="u-pull-left"> <a href="http://joshi4.github.io/" class="brand" style="font-weight:bold;font-size:normal"> Shantanu Joshi </a></li>
		  <li class="u-pull-right cate"> <a href="http://joshi4.github.io//about/" class=""> About </a></li>
		  
		</ul>
	  </div>
	</div>
  </div>
</nav>


<div class="container post-wrapper">
  <div class="row">
	<div class="eight columns offset-by-two">
	  <div id="post-title">
		<p class="footnote">
		  
		  <time class="">2014-07-21</time>
		  
		  
		  |
		  
		  
		  tags:<a href="http://joshi4.github.io//tags/append">append</a> <a href="http://joshi4.github.io//tags/slices">slices</a> 
		  

		  

		  

		</p>
		<h5>Small Gotcha in Go slices</h5>
	  </div>

	  <div class="post">
		<p>I am back to writing programs in Go after almost a year. Today, I ran into an issue at work that led me to re-read some important docs and revisit the fundamentals of slices in Go.</p>

<p>The issue is best explained using the ( representative )code below:</p>

<pre><code class="language-ruby">func main(){

slice := make([]string, 5)
slice = append(slice, &quot;foo&quot;)
fmt.Println(slice)

}
</code></pre>

<p>The output it provides was slightly confusing to me. I was expecting the output to be <code>[&quot;foo&quot;]</code> instead it turned out to be :</p>

<pre><code class="language-ruby">[    &quot;foo&quot;]
</code></pre>

<p>You can verify it <a href="http://play.golang.org/p/f1vw8_0cfM">here</a></p>

<p>I thought that this was something to do with Slices so I read the following two blog posts again to see if I had forgotten something fundamental</p>

<ul>
<li><a href="http://blog.golang.org/go-slices-usage-and-internals">Go slices : usage and internal </a></li>
<li><a href="http://blog.golang.org/slices">The mechanics of &lsquo;append&rsquo; </a></li>
</ul>

<p>While very useful in refreshing my memory of <code>slices</code> and <code>append</code> I wasn&rsquo;t able to immediately pin point what was wrong. In order to quickly get the job done and test if I was on the right track I resorted to using unidiomatic go and basically treated the slice as a regular array and indexed into it directly to &ldquo;append&rdquo;.</p>

<p>After verifying that I was on the right track, I experimented with the bug to see if I could determine my error.</p>

<p>Maybe it was a problem when  appending to an empty slice , so let me add some elements then try it. No dice. On second thoughts appending to an empty slice should never be a problem, that&rsquo;s just absurd.</p>

<p>After some more experimentation, I finally asked a colleague  and he pointed out my bug immediately. I had initialized the length and capacity of the slice to <code>5</code> and that was the source of my problems. Thinking of it in terms of an empty slice was my biggest mistake. <code>Go automatically initializes the underlying array with the appropriate default value</code>.</p>

<pre><code class="language-ruby">intSlice := make([]int, 5) // underlying array is -&gt; {0,0,0,0,0}
</code></pre>

<p>So the empty space which I thought was <code>&lt;nil&gt;</code> turned out to be the empty string. In hindsight, I should have immediately discarded the thought that it was <code>&lt;nil&gt;</code> as Go reports a nil value in the same format as I have used above.</p>

<p>So because I had been lazy and specified both the length and capacity as one, make had gone an allocated the underlying array of my desired capacity but while I assumed the length would be zero it was actually 5.</p>

<p>It can easily be verified by running the following snippet:</p>

<pre><code class="language-ruby">func main(){

slice := make([]string, 5)
slice = append(slice, &quot;foo&quot;)
fmt.Println(len(slice)) // output is 6. 

}
</code></pre>

<p>The solution is as simple as :</p>

<pre><code class="language-ruby">func main(){

slice := make([]string, 0, 5)
slice = append(slice, &quot;foo&quot;)
fmt.Println(slice) 

}

</code></pre>

<pre><code class="language-ruby">[&quot;foo&quot;]
</code></pre>

<p>Now the capacity of the underlying array is <code>5</code> but it&rsquo;s length is <code>0</code>( to start with) so <code>make</code> can&rsquo;t initialize any elements. Thus now when we use append, we get the expected result</p>

<p><strong>TL;DR:</strong> <em>Don&rsquo;t forget that Go helps out by automatically initialzing underlying array of a slice with sensible defaults.</em></p>

	  </div>
	</div>
  </div>
</div>

<div class="footer">
  <div class="container">
	<div class="row">
	  <div class="ten columns offset-by-two">
		<p class="footnote">
		  
		  (c) Shantanu Joshi 2015. Powered by hugo and theme is nofancy
		  
		  
		  Find me at

		  
		  <a href="https://github.com/joshi4" >GitHub2</a>
		  

		  

		  

		  

		  
		</p>
	  </div>
	</div>
  </div>
</div>


<script src="http://joshi4.github.io//js/jquery.min.js" type="text/javascript"></script>
<script src="http://joshi4.github.io//js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#menu").click(function(){
    $(".brand").text("HOME");
    $(".navbar ul li").removeClass("cate");
    $(".navbar").toggle();
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".navbar").removeAttr("style");
    }
  });
</script>

</body>
</html>

